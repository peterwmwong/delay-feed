<!DOCTYPE html>
<html>
<title>delay feed</title>
<style>
    html,
    body {
        position: relative;
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        background: black;
    }

    #delayedFeed,
    #liveFeedVideo {
        position: absolute;
    }

    #liveFeedVideo {
        width: 100%;
        height: 100%;
    }

    #delayedFeed {
        bottom: 24px;
        right: 24px;
        box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
        background-color: rgba(0, 0, 0, 0.5);
    }

    #delayedFeedCaption {
        color: white;
        font-family: sans-serif;
        font-size: 2.5rem;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(255.0, 0, 0, 0.75);
        text-align: center;
    }
</style>

<body>
    <video id="liveFeedVideo" autoplay></video>
    <div id="delayedFeed">
        <canvas id="delayedFeedCanvas"></canvas>
        <div id="delayedFeedCaption">Delayed Feed</div>
    </div>
    <script type="module">
        try {
            const DELAY_MS = 2000;
            const { liveFeedVideo, delayedFeedCanvas } = window;
            const captureCanvas = document.createElement('canvas');
            const captureCtx = captureCanvas.getContext('2d');
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            liveFeedVideo.srcObject = stream;
            const { width, height } = stream.getTracks()[0].getSettings();
            const [delayedWidth, delayedHeight] = [width * .75, height * .75];
            captureCanvas.width = delayedFeedCanvas.width = delayedWidth;
            captureCanvas.height = delayedFeedCanvas.height = delayedHeight;
            const renderVideoToCanvasLoop = () => {
                window.requestAnimationFrame(() => {
                    captureCtx.drawImage(liveFeedVideo, 0, 0, delayedWidth, delayedHeight);
                    const frame = captureCtx.getImageData(0, 0, delayedWidth, delayedHeight);
                    setTimeout(() => delayedFeedCanvas.getContext('2d').putImageData(frame, 0, 0), DELAY_MS);
                    renderVideoToCanvasLoop();
                });
            }
            renderVideoToCanvasLoop();
        } catch (e) { alert(e) };
    </script>
</body>

</html>